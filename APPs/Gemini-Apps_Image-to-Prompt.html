<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image-to-Prompt Generator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
        #image-uploader { display: none; }
        .upload-area.drag-over { background-color: #374151; } /* gray-700 */
        .loader {
            border: 4px solid #374151; /* gray-700 */
            border-top: 4px solid #3b82f6; /* blue-500 */
            border-radius: 50%;
            width: 40px; height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .result-card textarea { overflow-y: hidden; }
        #multi-prompt-output::-webkit-scrollbar { width: 6px; }
        #multi-prompt-output::-webkit-scrollbar-track { background: transparent; }
        #multi-prompt-output::-webkit-scrollbar-thumb { background: #4b5563; }
        #multi-prompt-output::-webkit-scrollbar-thumb:hover { background: #6b7280; }
    </style>
</head>
<body class="bg-slate-900 text-white flex flex-col items-center justify-center min-h-screen p-4 sm:p-6">

    <div id="app-container" class="w-full max-w-7xl h-auto max-h-[95vh] flex flex-col bg-slate-800 rounded-2xl shadow-2xl p-6 md:p-8 border border-slate-700">
        
        <div class="flex justify-between items-center mb-6 flex-shrink-0">
            <h1 class="text-lg font-bold text-slate-200">Image to Prompt</h1>
        </div>
        
        <div id="main-content" class="grid grid-cols-1 lg:grid-cols-2 gap-8 flex-grow min-h-0">

            <!-- Left Column: Results -->
            <div id="left-column" class="hidden lg:flex flex-col min-h-0">
                <div class="relative flex-grow bg-slate-900 rounded-lg border border-slate-700 min-h-0">
                    <div id="loader-overlay" class="hidden absolute inset-0 bg-slate-900/80 backdrop-blur-sm flex flex-col items-center justify-center rounded-lg z-10">
                        <div class="loader"></div>
                        <p class="mt-4 text-slate-300">AI is analyzing the image...</p>
                    </div>
                    <div id="multi-prompt-output" class="absolute inset-0 p-4 space-y-3 overflow-y-auto">
                        <div id="results-placeholder" class="flex items-center justify-center h-full text-slate-500">
                            <p>Generated prompts will appear here...</p>
                        </div>
                    </div>
                </div>
                <div class="flex justify-center mt-4 flex-shrink-0">
                    <button id="clear-all-btn" class="text-slate-400 hover:text-white text-xs font-semibold flex items-center gap-1.5 px-2 py-1 rounded-md hover:bg-slate-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        Clear All
                    </button>
                </div>
            </div>

            <!-- Right Column: Image, Controls & Generate Button -->
            <div class="flex flex-col space-y-4">
                <div id="image-preview-wrapper" class="relative w-full aspect-square bg-slate-900 rounded-lg flex items-center justify-center overflow-hidden border border-slate-700">
                    <label for="image-uploader" id="upload-area" class="upload-area transition-colors cursor-pointer w-full h-full flex flex-col items-center justify-center text-center p-8 border-2 border-dashed border-slate-600 rounded-lg hover:bg-slate-700 hover:border-blue-500">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 mb-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                        <p class="text-slate-300 font-semibold">Click or drag image here</p>
                    </label>
                    <input id="image-uploader" type="file" accept="image/*">
                    <img id="image-preview" src="#" alt="Image Preview" class="hidden max-w-full max-h-full object-contain">
                    <button id="change-image-icon" class="hidden absolute top-3 right-3 bg-slate-900/60 text-white p-2 rounded-full hover:bg-slate-700/80 transition-all backdrop-blur-sm" title="Change Image">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <h3 class="font-semibold text-slate-300 text-sm">AI Platform</h3>
                    <div class="relative" id="custom-platform-selector">
                        <button id="platform-select-button" class="w-full bg-slate-700 text-slate-200 p-2 rounded-md border border-slate-600 flex justify-between items-center text-left">
                            <span id="platform-select-text" class="text-sm">General</span>
                            <svg class="w-4 h-4 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        </button>
                        <div id="platform-select-dropdown" class="hidden absolute bottom-full mb-2 z-20 w-full bg-slate-700 border border-slate-600 rounded-md shadow-lg p-2 space-y-1"></div>
                    </div>
                </div>
                <button id="generate-btn" class="hidden w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors disabled:bg-slate-600 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                     <span>Generate Prompts</span>
                </button>
            </div>
        </div>
    </div>
    
    <footer class="w-full text-center py-4 text-xs text-slate-500">
        <span>Powered by Gemini AI</span>
        <span class="mx-2">|</span>
        <a href="https://github.com/1038lab" target="_blank" rel="noopener noreferrer" class="hover:text-slate-300 transition-colors">
            UI by AILab
        </a>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Constants and State ---
        const platformOptions = {
            general: 'General', sd: 'Stable Diffusion', midjourney: 'Midjourney', dalle3: 'DALL-E 3', 
            sora: 'Sora (Video)', veo: 'Veo (Video)', wan: 'WAN (Video)', dreamina: 'Dreamina',
            grok: 'Grok', nanobanana: 'Gemini (nanobanana)',
        };
        const promptInstruction = "Your response must contain a final prompt enclosed in `[PROMPT]` and `[/PROMPT]` tags. Outside of these tags, you may include a brief explanation of the prompt.";
        const systemPrompts = {
            general: `You are a universal AI art prompt expert. Based on the user's image, generate a clear, descriptive, and platform-agnostic English prompt focusing on the core subject, style, and mood. ${promptInstruction}`,
            sd: `You are an expert prompt engineer for Stable Diffusion. From the user's image, generate a detailed, specific, and creative English prompt using comma-separated keyword phrases for subject, details, style, lighting, and composition. ${promptInstruction}`,
            midjourney: `You are a top-tier Midjourney prompt specialist. Craft an optimized, highly descriptive, and artistic English prompt from the user's image. Focus on visual details, atmosphere, artist styles, lighting, and camera angles. Use comma-separated phrases and append \`--v 7.0\` at the end. ${promptInstruction}`,
            dalle3: `You are an expert in DALL-E 3 and natural language descriptions. From the user's image, generate a fluid, detail-rich descriptive English sentence or short paragraph for DALL-E 3. Avoid comma-separated keywords or special parameters. Describe the scene like an artist. ${promptInstruction}`,
            grok: `You will act as Grok, a rebellious and humorous AI. Generate a wildly creative, perhaps even bizarre, English prompt for an AI image generator based on the user's image. Be bold, imaginative, and unconventional. ${promptInstruction}`,
            sora: `You are a professional cinematographer crafting prompts for OpenAI's Sora. Convert the static image into a dynamic, cinematic scene description. Your English prompt should detail actions, camera movements (pan, dolly, close-up), atmosphere, and lighting changes to guide Sora in creating a high-quality video clip. ${promptInstruction}`,
            veo: `You are a visual effects supervisor writing a prompt for Google's Veo. Transform the provided image into a high-fidelity, stunning video scene. Your English prompt must describe not just the visual elements, but also the tone, pacing, and specific camera techniques (e.g., 'hyper-realistic slow-motion', 'sweeping aerial shot'). ${promptInstruction}`,
            wan: `You are a prompt engineer for the WAN video model. Based on the static image, create a detailed English prompt for a video clip. Structure your prompt by describing the [subject], [action/motion], [setting], and [visual style/aesthetics]. Your goal is to transform the image into a dynamic scene. ${promptInstruction}`,
            dreamina: `You are a social media content creator using Dreamina (剪映). Your task is to turn the image into a prompt for a short, engaging video clip perfect for platforms like TikTok. Your English prompt should be concise, trendy, and describe a scene with potential for viral appeal, including visual effects or transitions. ${promptInstruction}`,
            nanobanana: `You are an AI assistant specialized in generating prompts for Google's Gemini family of models (specifically nanobanana). Based on the user's image, create a conversational and highly descriptive prompt. Your goal is to capture the essence of the image in natural language, describing the scene, subjects, and artistic style in a way that feels like giving instructions to a creative partner. ${promptInstruction}`
        };
        let imageBase64Data = null;

        // --- DOM Element Cache ---
        const dom = {
            imageUploader: document.getElementById('image-uploader'),
            uploadArea: document.getElementById('upload-area'),
            imagePreview: document.getElementById('image-preview'),
            generateBtn: document.getElementById('generate-btn'),
            multiPromptOutput: document.getElementById('multi-prompt-output'),
            loaderOverlay: document.getElementById('loader-overlay'),
            leftColumn: document.getElementById('left-column'),
            changeImageIcon: document.getElementById('change-image-icon'),
            customPlatformSelector: document.getElementById('custom-platform-selector'),
            platformSelectButton: document.getElementById('platform-select-button'),
            platformSelectText: document.getElementById('platform-select-text'),
            platformSelectDropdown: document.getElementById('platform-select-dropdown'),
            clearAllBtn: document.getElementById('clear-all-btn'),
        };
        
        function initializePlatformSelector() {
            Object.entries(platformOptions).forEach(([value, name]) => {
                const isChecked = value === 'general';
                dom.platformSelectDropdown.innerHTML += `
                    <label class="flex items-center space-x-2 p-1.5 rounded-md hover:bg-slate-600 cursor-pointer">
                        <input type="checkbox" value="${value}" class="form-checkbox bg-slate-800 border-slate-500 rounded text-blue-500 focus:ring-blue-500" ${isChecked ? 'checked' : ''}>
                        <span class="text-slate-200 text-sm">${name}</span>
                    </label>
                `;
            });
            updatePlatformSelectText();
        }
        
        function updatePlatformSelectText() {
            const selected = getSelectedPlatforms();
            if (selected.length === 0) dom.platformSelectText.textContent = 'Select platforms';
            else if (selected.length === 1) dom.platformSelectText.textContent = platformOptions[selected[0]] || 'Select platforms';
            else dom.platformSelectText.textContent = `${selected.length} selected`;
        }

        /**
         * @param {File} file - The image file selected by the user.
         */
        function handleFile(file) {
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                imageBase64Data = e.target.result.split(',')[1];
                dom.imagePreview.src = e.target.result;
                dom.uploadArea.classList.add('hidden');
                dom.imagePreview.classList.remove('hidden');
                dom.changeImageIcon.classList.remove('hidden');
                dom.generateBtn.classList.remove('hidden');
                dom.leftColumn.classList.remove('hidden');
                dom.leftColumn.classList.add('flex');
            };
            reader.readAsDataURL(file);
        }

        async function handleGenerateClick() {
            if (!imageBase64Data) return;
            const selectedPlatforms = getSelectedPlatforms();
            if (selectedPlatforms.length === 0) {
                 dom.multiPromptOutput.innerHTML = `<div class="flex items-center justify-center h-full text-red-500"><p>Please select at least one AI platform.</p></div>`;
                 return;
            }

            dom.loaderOverlay.classList.remove('hidden');
            dom.generateBtn.disabled = true;
            
            const existingPlaceholder = document.getElementById('results-placeholder');
            if (existingPlaceholder) existingPlaceholder.style.display = 'none';

            const results = await Promise.all(selectedPlatforms.map(p => callGeminiAPI(p)));
            
            results.forEach(result => createResultCard(result.platform, result.content));

            dom.loaderOverlay.classList.add('hidden');
            dom.generateBtn.disabled = false;
        }

        /**
         * Calls the Gemini API to generate a prompt for a specific platform.
         * @param {string} platform - The target AI platform.
         * @returns {Promise<object>} A promise that resolves to the platform and generated content.
         */
        async function callGeminiAPI(platform) {
            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const payload = {
                    systemInstruction: { parts: [{ text: systemPrompts[platform] }] },
                    contents: [{ role: "user", parts: [ { text: "Analyze this image and generate a prompt." }, { inlineData: { mimeType: "image/jpeg", data: imageBase64Data } } ] }],
                };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`API Error: ${(await response.json()).error?.message || response.statusText}`);
                
                const result = await response.json();
                const generatedText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!generatedText) throw new Error("API did not return content.");

                const match = generatedText.match(/\[PROMPT\]([\s\S]*?)\[\/PROMPT\]/);
                const finalPrompt = match ? match[1].trim() : generatedText.trim();
                let explanation = match ? generatedText.replace(match[0], '').trim() : "";
                if (platform === 'general') explanation = "A platform-agnostic prompt focusing on core concepts. Good as a starting point for any model.";
                
                return { platform, content: { finalPrompt, explanation } };
            } catch (error) {
                console.error(`Error for ${platform}:`, error);
                return { platform, content: { finalPrompt: `Error generating for ${platform.toUpperCase()}: ${error.message}`, explanation: "" } };
            }
        }
        
        function createResultCard(platform, content) {
            const placeholder = document.getElementById('results-placeholder');
            if (placeholder) placeholder.remove();

            const platformColors = {
                general: 'text-slate-400', sd: 'text-sky-400', midjourney: 'text-purple-400',
                dalle3: 'text-teal-400', grok: 'text-emerald-400', sora: 'text-red-400',
                veo: 'text-rose-400', wan: 'text-orange-400', dreamina: 'text-cyan-400',
                nanobanana: 'text-yellow-400'
            };
            const card = document.createElement('div');
            card.className = 'result-card bg-slate-800/80 p-3 rounded-lg border border-slate-700 space-y-2';
            card.innerHTML = `
                <div class="flex justify-between items-start">
                    <h4 class="font-bold text-sm ${platformColors[platform] || 'text-white'}">${platformOptions[platform] || platform.toUpperCase()}</h4>
                    <button class="copy-prompt-btn p-1.5 text-slate-400 hover:text-white hover:bg-slate-700 rounded-md transition-colors" title="Copy Prompt">
                        <svg class="w-5 h-5 pointer-events-none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                    </button>
                </div>
                ${content.explanation ? `<p class="text-slate-400 text-xs border-l-2 border-slate-600 pl-2">${content.explanation}</p>` : ''}
                <textarea readonly class="w-full bg-slate-700/50 text-slate-300 p-2 rounded-md text-sm resize-none border-0 focus:ring-0">${content.finalPrompt}</textarea>
            `;
            dom.multiPromptOutput.prepend(card);
            setTimeout(() => card.querySelector('textarea').style.height = `${card.querySelector('textarea').scrollHeight}px`, 0);
        }
        
        function showCopySuccess(button) {
            const originalIcon = button.innerHTML;
            button.innerHTML = `<svg class="w-5 h-5 text-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>`;
            button.disabled = true;
            setTimeout(() => { button.innerHTML = originalIcon; button.disabled = false; }, 2000);
        }

        function handlePerCardCopy(button) {
            const textarea = button.closest('.result-card').querySelector('textarea');
            if (!textarea || !textarea.value) return;

            textarea.removeAttribute('readonly');
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices

            try {
                document.execCommand('copy');
                showCopySuccess(button);
            } catch (err) {
                console.error('Copy command failed', err);
            }

            textarea.setAttribute('readonly', true);
            if (window.getSelection) {
                window.getSelection().removeAllRanges();
            } else if (document.selection) {
                document.selection.empty();
            }
        }

        // --- Event Listeners Setup ---
        
        function getSelectedPlatforms() { return Array.from(dom.platformSelectDropdown.querySelectorAll('input:checked')).map(cb => cb.value); }

        function bindEventListeners() {
            dom.clearAllBtn.addEventListener('click', () => {
                 dom.multiPromptOutput.innerHTML = `<div id="results-placeholder" class="flex items-center justify-center h-full text-slate-500"><p>Generated prompts will appear here...</p></div>`;
            });

            dom.imageUploader.addEventListener('change', (e) => handleFile(e.target.files[0]));
            dom.changeImageIcon.addEventListener('click', () => dom.imageUploader.click());
            dom.generateBtn.addEventListener('click', handleGenerateClick);
            
            dom.platformSelectButton.addEventListener('click', () => dom.platformSelectDropdown.classList.toggle('hidden'));
            dom.platformSelectDropdown.addEventListener('change', updatePlatformSelectText);
            document.addEventListener('click', (e) => {
                if (!dom.customPlatformSelector.contains(e.target)) dom.platformSelectDropdown.classList.add('hidden');
            });
            dom.multiPromptOutput.addEventListener('click', (e) => e.target.closest('.copy-prompt-btn') && handlePerCardCopy(e.target.closest('.copy-prompt-btn')));

            // Drag and Drop Listeners
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                document.body.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); });
                dom.uploadArea.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); });
            });
            ['dragenter', 'dragover'].forEach(eventName => dom.uploadArea.addEventListener(eventName, () => dom.uploadArea.classList.add('drag-over')));
            ['dragleave', 'drop'].forEach(eventName => dom.uploadArea.addEventListener(eventName, () => dom.uploadArea.classList.remove('drag-over')));
            dom.uploadArea.addEventListener('drop', (e) => handleFile(e.dataTransfer.files[0]));
        }

        // --- App Initialization ---
        
        function init() {
            initializePlatformSelector();
            bindEventListeners();
        }

        init();
    });
    </script>
</body>
</html>
